---
services:
  tests:
    build: .
    image: ${RUN_TEST_IMAGE:-ghcr.io/chtrifork/ansible-kubeadm:latest}
    working_dir: "${PWD}"
    entrypoint: [
      "${PWD}/scripts/detect-user.sh",
      "/bin/bash", "-c",
      "poetry install && poetry run pytest --capture=no $$@", "--"
    ]
    command: ["-x"]
    extends:
      service: terraform
